---
import "../styles/global.css";
import { initMobileMenu } from "../scripts/mobileMenu";
import { initActiveNav } from "../scripts/activeNav";
import es from "../i18n/es.json";
import en from "../i18n/en.json";
import it from "../i18n/it.json";

type Lang = "es" | "en" | "it";
const dict: Record<Lang, typeof es> = { es, en, it };

const lang = (Astro.url.pathname.split("/")[1] || "es") as Lang;
const t = dict[lang];

const navItems = [
  { label: t.header.about, href: `/${lang}` },
  { label: t.header.projects, href: `/${lang}/projects` },
  { label: t.header.skills, href: `/${lang}/skills` },
  { label: t.header.contact, href: `/${lang}/contact` },
];

const pathname = Astro.url.pathname;

// quitar '/siglas pais' del inicio
const currentPath = pathname.replace(/^\/(es|en|it)/, "") || "";

const languages = [
  { code: "es", name: "Español" },
  { code: "en", name: "English" },
  { code: "it", name: "Italiano" },
];
---

<header class="sticky top-0 z-10 w-full backdrop-blur-lg border-b border-gray-800">
  <div class="mx-auto flex max-w-7xl items-center justify-between px-4 sm:px-6 lg:px-8 py-3">
    <a href=`/${lang}` class="logo flex items-center gap-3">
      <img src="/logo.svg" alt="" class="h-6" />
      <h2 class="lg:text-2xl font-bold">Portfolio</h2>
    </a>

    <!-- NAV DESKTOP -->
    <nav class="hidden md:flex items-center gap-8" aria-label="Main navigation">
      {
        navItems.map((item) => (
          <a
            href={item.href}
            class="lg:text-lg font-medium transition-colors text-gray-600 hover:text-[#31a8cc] hover:underline"
          >
            {item.label}
          </a>
        ))
      }
    </nav>

    <!-- LANGUAGE SELECTOR -->
    <div class="flex items-center gap-2">
      {
        languages.map((l) => (
          <a
            href={`/${l.code}${currentPath}`}
            class={`inline-flex items-center transition ${
              l.code === lang ? "opacity-100" : "opacity-30 hover:opacity-100"
            }`}
            aria-label={l.name}
            title={l.name}
          >
            <img src={`/flags/${l.code}.svg`} alt={l.name} class="h-5" loading="lazy" />
          </a>
        ))
      }
    </div>

    <!-- TOGGLE THEME -->
    <button
      id="theme-toggle"
      class="ml-2 rounded-full px-2 py-1 hover:bg-gray-400 transition-colors cursor-pointer"
      aria-label="Toggle dark mode"
    >
      <img data-theme-icon src="/icons/light-mode.svg" alt="Toggle theme" class="h-6 w-6" />
    </button>

    <div class="flex items-center">
      <a
        href="/JoseLuisVasquezDrouet_CV.pdf"
        download
        title={t.header.cv}
        class="items-center justify-center rounded-full lg:rounded bg-[#31a8cc] p-2 text-sm font-bold !text-white shadow-sm transition-colors hover:bg-[#31a8cc]/90 focus:outline-none focus:ring-2 focus:ring-[#31a8cc] focus:ring-offset-2"
      >
        <img src="/icons/download.svg" alt="Icono de descarga" class="inline-block h-6 w-6" />
        <span class="hidden lg:inline">{t.header.cv}</span>
      </a>

      <!-- BOTÓN MÓVIL -->
      <button
        id="menu-toggle"
        aria-controls="mobile-menu"
        aria-expanded="false"
        class="md:hidden ml-4 p-2 rounded-md text-gray-600 bg-gray-300 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#31a8cc] cursor-pointer"
      >
        <!-- <span class="sr-only">Abrir menú</span> -->
        <img src="/icons/menu.svg" alt="Icono de menú" class="h-6 w-6" />
      </button>
    </div>
  </div>

  <!-- MENU MÓVIL: aparece solo en pantallas < md -->
  <div id="mobile-menu" class="md:hidden hidden border-t border-gray-200">
    <div class="mx-auto max-w-7xl px-4 py-4 flex flex-col gap-2">
      {
        navItems.map((item) => (
          <a href={item.href} class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-100">
            {item.label}
          </a>
        ))
      }
      <a
        href="/JoseLuisVasquezDrouet_CV.pdf"
        download
        class="mt-2 inline-flex items-center justify-center rounded bg-[#31a8cc] px-4 py-2 text-sm font-bold text-white shadow-sm hover:bg-[#31a8cc]/90"
      >
        {t.header.cv}
      </a>
    </div>
  </div>
</header>

<script is:inline>
  const init = () => {
    initMobileMenu();
    initActiveNav();
  };

  document.addEventListener("astro:page-load", init);
  document.addEventListener("astro:after-swap", init);
</script>
